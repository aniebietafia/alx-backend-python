#!/bin/bash

# A script to start a local Kubernetes cluster using Minikube,
# verify its status, and list the running pods.

# --- Style Definitions ---
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}### Kubernetes Local Setup Script ###${NC}"

# 1. Check if Minikube is installed
echo -e "\n${YELLOW}[Step 1/4] Checking for Minikube installation...${NC}"
if ! command -v minikube &> /dev/null
then
    echo -e "${RED}Error: minikube could not be found.${NC}"
    echo "Please install Minikube before running this script."
    echo "Installation guide: https://minikube.sigs.k8s.io/docs/start/"
    exit 1
else
    echo -e "${GREEN}Success: Minikube is installed.${NC}"
fi

# 2. Start the Kubernetes cluster
echo -e "\n${YELLOW}[Step 2/4] Starting the Minikube Kubernetes cluster...${NC}"
echo "This might take a few minutes, especially on the first run."

if minikube start; then
    echo -e "${GREEN}Success: Minikube cluster started.${NC}"
else
    echo -e "${RED}Error: Failed to start Minikube cluster.${NC}"
    echo "Try running 'minikube delete' and then run this script again."
    exit 1
fi

# 3. Verify the cluster is running
echo -e "\n${YELLOW}[Step 3/4] Verifying cluster status with 'kubectl cluster-info'...${NC}"
kubectl cluster-info

# 4. Retrieve available pods
echo -e "\n${YELLOW}[Step 4/4] Retrieving all available pods in the cluster...${NC}"
kubectl get pods --all-namespaces

echo -e "\n${GREEN}### Script finished successfully! Your local Kubernetes cluster is ready. ###${NC}"
